<?php

class bank001 extends boletoFunctions 
{
    var $nossoNumero;
    var $codigoBarras;
    var $linhaDigitavel;
    var $carteira;
    var $dvCodigoBanco;

    public function __construct ( $data )
    {
        $codigoBanco = '001';
        $codigoMoeda = '9';
        $fatorVencimento = $this->fator_vencimento($data->maturityDate);
        $valorDocumento = $this->formata_numero($data->invoiceValue,10,0,"valor");
        $this->carteira = $data->wallet;
        
        $this->dvCodigoBanco= $this->geraCodigoBanco($codigoBanco);
        $data->branch       = $this->formata_numero($data->branchNumber, 4, 0, "valor");
        $data->account      = $this->formata_numero($data->accountNumber, 7, 0, "valor");

        switch ( $data->variation )
        {
            case 1:
                if ( strlen((string)$data->accord) < 5 && strlen((string)$data->accord) > 0 )
                {
                    $data->accord       = $this->formata_numero($data->accord, 4, 0, "valor");
                    $data->nossoNumero  = $this->formata_numero($data->bankInvoiceId, 7, 0, "valor");
                    $data->nossoNumero  = $data->accord . $data->nossoNumero;
                }
                else if ( strlen((string)$data->accord) > 5 )
                {
                    $data->accord       = $this->formata_numero($data->accord, 6, 0, "valor");
                    $data->nossoNumero  = $this->formata_numero($data->bankInvoiceId, 5, 0, "valor");
                    $data->nossoNumero  = $data->accord . $data->nossoNumero;
                }
                else
                {
                    $data->nossoNumero  = $this->formata_numero($data->bankInvoiceId, 11, 0, "valor");
                }
                $campoLivre  = $data->nossoNumero;
                $campoLivre .= $data->branch;
                $campoLivre .= $data->account;
                $campoLivre .= '21';
                break;
            case 2:
                $data->nossoNumero  = $this->formata_numero($data->bankInvoiceId, 17, 0, "valor");
                $data->accord       = $this->formata_numero($data->accord, 6, 0, "valor");
                $campoLivre  = $data->accord;
                $campoLivre .= $data->nossoNumero;
                $campoLivre .= '21';
                break;
            case 3:
                $data->nossoNumero  = $this->formata_numero($data->bankInvoiceId, 10, 0, "valor");
                $data->accord       = $this->formata_numero($data->accord, 7, 0, "valor");
                $campoLivre  = $this->formata_numero('', 6, 0, "valor");
                $campoLivre .= $data->accord;
                $campoLivre .= $data->nossoNumero;
                $campoLivre .= $data->wallet;
                break;
            default:
                $data->nossoNumero  = $this->format_numero($data->bankInvoiceId, 11, 0, "valor");
                $campoLivre  = $data->branch;
                $campoLivre .= $data->wallet;
                $campoLivre .= $data->nossoNumero;
                $campoLivre .= $data->account;
                $campoLivre .= '1';
                break;
        }
        
        $dvGeral                    = $this->digitoVerificador_barra("$codigoBanco$codigoMoeda$fatorVencimento$valorDocumento$campoLivre");

        $this->codigoBarras         =   "$codigoBanco$codigoMoeda$dvGeral$fatorVencimento$valorDocumento$campoLivre";
        $this->linhaDigitavel       =   $this->monta_linha_digitavel($this->codigoBarras);
        $this->nossoNumero          =   $data->nossoNumero;
        $this->agenciaCodigoCedente =   $data->branchNumber . " / " . $data->accountNumber . '-' . $data->accountNumberDigit;
    }
}
?>
