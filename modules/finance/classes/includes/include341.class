<?php

class bank341 extends boletoFunctions
{
    var $nossoNumero;
    var $codigoBarras;
    var $linhaDigitavel;
    var $carteira;
    var $dvCodigoBanco;
    var $cip;
    var $usoBanco;
    var $especieDocumento;
    var $cedente;
    var $sacadoAvalista;
    var $sacadoAvalistaCpf;


    public function __construct ( $data )
    {
        $codigoBanco = '341';
        $codigoMoeda = '9';
        $fatorVencimento = $this->fator_vencimento($data->maturityDate);
        $valorDocumento = $this->formata_numero($data->invoiceValue,10,0,"valor");
        
        $this->carteira = $data->wallet;
        
        $this->dvCodigoBanco= $this->geraCodigoBanco($codigoBanco);
        $data->branch       = $this->formata_numero($data->branchNumber, 4, 0, "valor");
        $data->account      = $this->formata_numero($data->accountNumber, 7, 0, "valor");
        switch ( $data->variation )
        {
            default:
                $data->nossoNumero  = $this->formata_numero($data->bankInvoiceId, 8, 0, "valor");
                $data->dvNossoNumero= $this->digitoVerificador_nossonumero($data->branchNumber.$data->accountNumber.$data->wallet.$data->nossoNumero);
                $campoLivre .= $data->wallet;
                $campoLivre .= $data->nossoNumero;
                $campoLivre .= $data->dvNossoNumero;
                $campoLivre .= $this->formata_numero($data->branchNumber, 4, 0, "valor");
                $campoLivre .= $this->formata_numero($data->accountNumber, 5, 0, "valor");
                $campoLivre .= $this->formata_numero($data->accountNumberDigit, 1, 0, "valor");
                $campoLivre .= '000';
                $this->especieDocumento = 'DP';
                break;
        }
        $data->nossoNumero = $data->wallet . ' / '.$data->nossoNumero. '-'. $data->dvNossoNumero ;
        $dvGeral                    = $this->digitoVerificador_barra("$codigoBanco$codigoMoeda$fatorVencimento$valorDocumento$campoLivre");

        $this->codigoBarras         =   "$codigoBanco$codigoMoeda$dvGeral$fatorVencimento$valorDocumento$campoLivre";
        $this->linhaDigitavel       =   $this->monta_linha_digitavel($this->codigoBarras);
        $this->nossoNumero          =   $data->nossoNumero;
        $this->agenciaCodigoCedente =   $data->branchNumber . " / " . $this->formata_numero($data->accountNumber,5,0,"valor") . '-' . $data->accountNumberDigit;
    }
    
    public function digitoVerificador_nossonumero($numero) 
    {
        $resto = $this->modulo_10($numero);
        return $resto;
    }
}
?>
