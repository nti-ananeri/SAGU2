<?php

/**
 * Form to manipulate a pupilListing
 **/
$MIOLO = MIOLO::getInstance();
$MIOLO->Uses('forms/FrmExtendedReports.class', 'academic');

class FrmExploitationReport extends FrmExtendedReports
{

    public function newFields ( )
    {
        $MIOLO  = MIOLO::getInstance();
        $module = MIOLO::getCurrentModule();
        $action = MIOLO::getCurrentAction();
        
        $exploitationTypeData[] = array ( 'Internal', _M('Internal', 'academic'));
        $exploitationTypeData[] = array ( 'External', _M('External', 'academic'));

        $exploitationTypeLabel = new MText('exploitationTypeLabel', _M('Type', $module));
        $exploitationTypeLabel->setWidth(FIELD_CONTAINER_SIZE);
        
        $exploitationType = new MSelection('exploitationType', $this->getFormValue('exploitationType', $data->exploitationType), null, $exploitationTypeData);
        $fields[] = new MHContainer('hctexploitationType', array($exploitationTypeLabel, $exploitationType));
        
        $personLabel    = new MText('personLabel', _M('Person', 'basic'));
        $personLabel->setWidth(FIELD_CONTAINER_SIZE);
        $flds[]         = $personLabel;

        $personId       = new MLookupTextField('personId', $this->getFormValue('personId',$data->personId), '', FIELD_ID_SIZE, null, null, 'personName', 'basic', 'PhysicalPerson', null, null, true);
        $personId->setJsHint(_M('Enter the person code',$module));
        $flds[]         = $personId;

        $personName   = new MTextField('personName', $this->getFormValue('personName', $data->personName), _M('Person name',$module), FIELD_DESCRIPTION_SIZE);
        $personName->setJsHint(_M('Enter the person name',$module));
        $flds[]       = $personName;

        $hctPerson = new MHContainer('hctPerson', $flds);
        $hctPerson->setShowLabel(false);
        
        $fields[]  = $hctPerson;
        
        unset($flds);
        $exploitationDetailsLabel = new MText('exploitationDetailsLabel', _M('Print exploitations details', $module));
        $exploitationDetailsLabel->setWidth(FIELD_CONTAINER_SIZE);

        $exploitationDetails = new MCheckBox('exploitationDetails', 1, '', $this->getFormValue('exploitationDetails', $data->exploitationDetails));

        $hctExploitationDetails = new MHContainer('hctExploitationDetails', array ( $exploitationDetailsLabel, $exploitationDetails ) );

        $fields[] = $hctExploitationDetails;
        
        return $fields;
    }

    /**
     * Event triggered when user chooses Delete from the toolbar
     **/
    public function tbBtnPrint_click($sender = null)
    {
        $MIOLO  = MIOLO::getInstance();
        $module = MIOLO::getCurrentModule();
        $action = MIOLO::getCurrentAction();
        $filter = $this->getData();
        foreach ( $filter as $item => $value )
        {
            if (stristr($item, 'Label') || strlen((string)$value) == 0 ) 
            {
                unset($filter->$item);
            }
        }
        switch ($filter->reportType)
        {
            case 1:
                //Analytical
                $reportX = 'RptExploitationReportAnalytical';
                break;
            case 2:
                $reportX = 'RptExploitationReportSynthetic';
                break;
        }
        $MIOLO->getClass($module,$reportX);
        $report = new $reportX($filter);
    }

}

?>
