<?php

class FrmPrintableListForStudentCard extends MForm
{

    /**
     * Class constructor
     **/
    function __construct($data=null)
    {
        $MIOLO           = MIOLO::getInstance();
        $module          = MIOLO::getCurrentModule();

        parent::__construct(_M('Printable listing for student identity card', $module) );

        $this->setHelp(get_class($this), MIOLO::getCurrentModule(), MIOLO::getCurrentAction());

        $this->eventHandler();
    }

    /**
     * Default method to define fields
     **/
    public function createFields()
    {

        $MIOLO     = MIOLO::getInstance();
        $module    = MIOLO::getCurrentModule();
        $action    = MIOLO::getCurrentAction();
        $function  = MIOLO::_request('function');
        $event     = MIOLO::_request('event');

        $toolBar = new MToolBar('toolBar',$MIOLO->getActionURL($module,$action));

		$toolBar->hideButton('tbBtnDelete');
   		$toolBar->hideButton('tbBtnSearch');
        $toolBar->hideButton('tbBtnSave');
		$toolBar->hideButton('tbBtnNew');
        $fields[] = $toolBar;
        $businessStudentCard = $MIOLO->getBusiness($module, 'BusStudentCard');
        $list = $businessStudentCard->listStudentCardList();
        $listForStudentCard = new MSelection('listForStudentCard', $this->getFormValue('listForStudentCard', $data->listForStudentCard), _M('Student card listing', $module), $list);
        $validators[] = new MRequiredValidator('listForStudentCard', _M('Student card listing',$module));
        $fields[] = $listForStudentCard;
        $fields[] = new Separator('');
        $divError = new MDiv('divError', null, null, 'align=center');
        $fields[] = $divError;

        
        $this->setFields($fields);
        $this->setValidators($validators);
        $this->setLabelWidth(FIELD_LABEL_SIZE);
		$this->setShowPostButton(false);
        $this->setClose($MIOLO->getActionURL($module,substr($action,0,strrpos($action,':'))));
    }

    public function tbBtnPrint_click($sender = null)
    {
		$MIOLO = MIOLO::getInstance();
		$module = MIOLO::getCurrentModule();
        $d = explode('|', $this->getFormValue('listForStudentCard'));
        $data->periodId     = $d[0];
        $data->listagemId    = $d[1];
        
        $class = 'RptStudentCardSheet';
        $MIOLO->getClass($module, $class);
        $report = new $class($data);
    }
}
