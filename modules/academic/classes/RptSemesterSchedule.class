<?php

/**
 * Default defines 
 * To report identification
 */
define('FPDF_FONTPATH', $MIOLO->getModulePath('basic', '/classes/fpdf/font/'));

$MIOLO = MIOLO::getInstance();
$module = MIOLO::getCurrentModule();
$MIOLO->Uses('classes/fpdf/fpdf.php', 'basic');

/**
 * Create header and footer information
 */
class PDF extends FPDF
{
    public $company;

    /**
     * Defines the footer for this report
     */
    public function Footer()
    {
    }

    /**
     * Defines the header for this report
     */
    public function Header()
    {
        $module = MIOLO::getCurrentModule();
        $MIOLO  = MIOLO::getInstance();

        if ( strlen((string)SAGUFile::getPhotoPath($this->company->personId)) > 0 )
        {
            $this->Image(SAGUFile::getPhotoPath($this->company->personId), 10, 5, '30', '', PHOTO_FORMAT);
        }

        $this->ln(20);
    }
}


/**
 * PDF extension to generate report
 */
class RptSemesterSchedule 
{
    /**
     * Method to generate the report
     */
    public function RptSemesterSchedule($data = null)
    {
        $MIOLO  = MIOLO::getInstance();
        $module = MIOLO::getCurrentModule();

        // Generating PDF file
        $pdf = new PDF();

        $pdf->company = $data->company;

        $pdf->aliasNbPages();

        $pdf->setFillColor(242);

        // First page
        $pdf->addPage('P', 'mm', 'A4');

        $oldDay      = NULL;
        $oldCourseId = NULL;

        $firstLoop = true;

        foreach( $data->semesterSchedule as $semesterSchedule )
        {
            if ( $oldDay != $semesterSchedule[6] )
            {
                $pdf->setFont(DEFAULT_REPORT_FONT, 'B', 10);
                if($firstLoop == false)
                {
                    $pdf->ln(20);
                }
                else
                {
                    $firstLoop = false;
                }
                $pdf->cell(190, 6, $semesterSchedule[6], '', 0, 'C');
                $pdf->ln(2);
            }

            if ( ($oldCourseId != $semesterSchedule[2]) || ($oldDay != $semesterSchedule[6]))
            {
                $pdf->ln(15);
                $pdf->setFont(DEFAULT_REPORT_FONT, 'B', 10);
                $pdf->cell(190, 6, $semesterSchedule[2] . ' - ' . $semesterSchedule[3] . ' ' . $semesterSchedule[4], '', 0, 'C');

                $pdf->ln(10);
                $pdf->setFont(DEFAULT_REPORT_FONT, 'B', 10);
                $pdf->cell(72, 6, _M('Curricular component', $module),               'TBLR', 0, 'L', 1);
                $pdf->cell(23, 6, _M('Room', $module). ' - ' . 'Prédio',             'TBLR', 0, 'C', 1);
                $pdf->cell(70, 6, _M('Professor', $module),                          'TBLR', 0, 'C', 1);
                $pdf->cell(25, 6, _M('Lessons begin', $module),                      'TBLR', 0, 'C', 1);
            }

            $pdf->setFont(DEFAULT_REPORT_FONT, '', 10);
            $pdf->ln(6);
            $pdf->cell(72, 6, substr($semesterSchedule[1], 0, 30),                  'TBLR', 0, 'L');
            $pdf->cell(23, 6, substr($semesterSchedule[9] . ' - ' . $semesterSchedule[8], 0, 11) , 'TBLR', 0, 'C');
            $pdf->cell(70, 6, substr($semesterSchedule[11], 0, 30),                 'TBLR', 0, 'L');
            $pdf->cell(25, 6, $semesterSchedule[12],                                'TBLR', 0, 'C');

            $oldDay      = $semesterSchedule[6];
            $oldCourseId = $semesterSchedule[2];
        }

        $pdf->close();
        $pdf->output();
    }
}

?>
