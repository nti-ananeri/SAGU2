<?php
set_time_limit(0);        
$MIOLO  = MIOLO::getInstance();
$module = 'academic';
define('REPORT_ID', strtoupper(_M('Statement of completion', $module))); 
define('FPDF_FONTPATH', $MIOLO->getModulePath('basic', '/classes/fpdf/font/'));
$MIOLO->Uses('classes/fpdf/pdf.php', 'basic');

class RptStatementOfCompletion extends PDF
{
    public function __construct($filters = NULL)
    {
        $MIOLO = MIOLO::getInstance();
        $this->title = strtoupper(REPORT_ID);
        $db = $MIOLO->getBusiness('academic', 'BusContractDocument');
        $this->filters = $filters;
        $filters = $db->getContract($filters);
        parent::__construct();
        $this->useUserInfo = false;
        $this->AddPage('P', 'mm', 'A4');
        $this->aliasNbPages();
        $this->generatePDF($filters);
    }
	
    public function generatePDF($data)
    {
        $this->generateContent($data);
        PDF::generatePDF();
    }

    protected function replaceText($rdata)
    {
        parent::replaceText($rdata);

        $text = str_replace($this->procurar, $this->substituir, DECLARATION_COURSE_CONCLUSION);

        return $text;
    }

    protected function generateContent($rdata)
    {	   
 
        $MIOLO  = MIOLO::getInstance();
        $busStamp         = $MIOLO->getBusiness('basic','BusStamp');
        $busPerson        = $MIOLO->getBusiness('basic','BusPhysicalPerson');
        $busDocument      = $MIOLO->getBusiness('basic','BusDocument');
        $busMaritalStatus = $MIOLO->getBusiness('basic','BusMaritalStatus');
        $busCity          = $MIOLO->getBusiness('basic','BusCity');
        $busState         = $MIOLO->getBusiness('basic','BusState');
        $busStamp         = $MIOLO->getBusiness('basic','BusStamp');
        $busCountry       = $MIOLO->getBusiness('basic','BusCountry');
        $busAgreementTerm = $MIOLO->getBusiness('finance', 'BusAgreementTerm');
        
        $stamp          = $busStamp->getStamp($this->filters->stampId);
        $module = MIOLO::getCurrentModule();
        $module = 'academic';
    
     	$this->setFont(DEFAULT_REPORT_FONT, '', 12);

        $this->lsize = 7;
        $text = $this->replaceText($rdata);
     
        $this->multiCell($this->psize, $this->lsize,$text, null, 'J');
        $this->ln();
        $this->ln($this->lsize*2);
        $this->MultiCell($this->psize, 5,$rdata->company->cityName.', '.date('d').' de '.SAGU::listMonths(date('n')).' de '.date('Y'),'','C');  
        $this->ln($this->lsize*2);
 		$this->Cell(($this->psize/10)*2, $this->lsize,'','','C');
    	$this->Cell(($this->psize/10)*6, $this->lsize,'','B','C');
        $this->ln($this->lsize);
   		$this->MultiCell($this->psize, $this->lsize, $stamp->personName,'','C');
   		$this->MultiCell($this->psize, $this->lsize, $stamp->functionDescription,'','C');
        $this->lsize = 4;
	}
}
?>
