<?php

define('FPDF_FONTPATH', $MIOLO->getModulePath('basic', '/classes/fpdf/font/'));

$MIOLO = MIOLO::getInstance();
$MIOLO->Uses('classes/fpdf/pdf.php', 'basic');

class RptPupilCadastralSheet extends PDF
{
    var $module = 'academic';
    public function __construct($data = NULL)
    {
        $MIOLO = MIOLO::getInstance();
        $this->db = $MIOLO->getBusiness('academic', 'BusPupilCadastralSheet');
        $this->title = strtoupper(_M('Pupil cadastral sheet', $this->module));
        
        $rdata->unitId = $this->db->getUnitContract($data->contractId);
        parent::__construct($rdata);
        
        $this->defaultFontSize = 8;
        foreach ($data as $item=> $value)
        {
            $this->contract->{$item} = $value;
        }
        $this->useUserInfo = false;
        $this->addPage('P', 'mm', 'A4');
        $this->lsize = 3.5;
        $this->aliasNbPages();
        $this->putHeaderLine();
        $this->outPut();
    }
    
    public function putHeaderLine()
    {
        $this->putHeaderContract();
    }

    public function getContractInfo()
    {
        $data = $this->db->getHeaderContract($this->contract);
        $this->pupil = $data[0];
    }

    public function putHeaderContract()
    {
        /* Informacoes do contrato do aluno */  
        $this->getContractInfo();
        //Vestibular/Inscricao
        $foto = SAGUFile::getPhotoPath($this->pupil->personalData->personId);
        $yy = $this->y-($this->lsize/2);
   //     $this->setFont(DEFAULT_REPORT_FONT, 'B', 10);
   //     $this->setFont(DEFAULT_REPORT_FONT, 'B', 7);
        $this->setY($yy+(40/2)-($this->lsize/2));
        $this->cell(($this->psize), $this->lsize, strtoupper(_M('Course', $this->module)). ':  '. $this->pupil->personalData->courseName, null, null, 'C');
        $this->ln();
        $this->cell(($this->psize), $this->lsize, strtoupper(_M('Contract id', $this->module)) . ':  '.str_pad($this->pupil->personalData->contractId, 5, 0, STR_PAD_LEFT) , null, null, 'C');
        $this->ln();
        $this->cell(($this->psize), $this->lsize, strtoupper(_M('Person id', $this->module)) . ':  '.str_pad($this->pupil->personalData->personId, 5, 0, STR_PAD_LEFT) , null, null, 'C');
        $this->ln();
        $this->cell(($this->psize), $this->lsize, strtoupper(_M('Turn', $this->module)) . ':  '.str_pad($this->pupil->personalData->turnDescription, 5, 0, STR_PAD_LEFT) , null, null, 'C');
        $this->ln();
        $this->cell(($this->psize), $this->lsize, strtoupper(_M('Class', $this->module)) . ':  '.str_pad($this->pupil->personalData->className, 0, 0, STR_PAD_LEFT) , null, null, 'C');
        $this->ln();

        if( $foto )
        {
            $this->Rect(($this->psize)-20, $yy, 30, 40);
            $this->Image($foto, ($this->psize)-20+0.1, $yy+0.2, NULL, 39.6, PHOTO_FORMAT);
            $this->setY($yy+40);
        }
        else
        {
            $this->Rect(($this->psize)-20, $yy, 30, 40);
            $this->setY($yy+(40/2)-3);
            $this->setX($this->psize-24);
            $this->cell(($this->psize/5), $this->lsize, _M('Photo', 'basic'), null, null, 'C');
            $this->setY(($yy+40)-($this->lsize/2));
        }
        
        $this->setFont(DEFAULT_REPORT_FONT, 'B', 8);
        $this->SetFillColor(180,180,180);
        $this->cell($this->calcTextSize(strtoupper(_M('Ingression form', 'academic'))), $this->lsize, strtoupper(_M('Ingression form', 'academic')), 1, null, 'C', 1);
        $this->ln();
        
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10, $this->lsize, _M('Year', $this->module) . '/' . _M('Semester', $this->module) . ':', 'LTB');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15, $this->lsize, str_replace('.', '/', $this->pupil->selectiveProcess->periodId), 'TB');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10, $this->lsize, _M('Points', $this->module) . ':', 'TB', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.07, $this->lsize, _M($this->pupil->selectiveProcess->totalPoints, $this->module), 'TB', null);
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.13, $this->lsize, _M('Ingression form', $this->module) .':', 'TB');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.45,$this->lsize, $this->pupil->selectiveProcess->ingressionForm, 'TRB', null, 'R');
        $this->ln();
        $this->ln($this->lsize/3);
             
        //Dados pessoais 
        $this->setFont(DEFAULT_REPORT_FONT, 'B', 8);
        $this->SetFillColor(180,180,180);
        $this->cell($this->calcTextSize( strtoupper(_M('Personal data', 'academic')) ), $this->lsize, strtoupper(_M('Personal data', 'academic')), 1, null, 'C', 1);
        $this->ln();
        /* Nome e código de pessoa Linha 1*/
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.12, $this->lsize, _M('Pupil name', $this->module) . ':', 'LT');
        $this->setFont(DEFAULT_REPORT_FONT, 'IB', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.45, $this->lsize, $this->pupil->personalData->name, 'T');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.05, $this->lsize, _M('Sex', $this->module) . ':', 'T', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.13, $this->lsize, _M($this->pupil->personalData->sex, $this->module), 'T', null);
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10, $this->lsize, _M('Marital status', $this->module) .':', 'T', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15,$this->lsize, $this->pupil->personalData->marital, 'TR', null, 'R');
        $this->ln();

        /* Data de nascimento, naturalidade e nacionalidade de pessoa Linha 3*/
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15, $this->lsize, _M('Birth date', $this->module) .':', 'L');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10,$this->lsize, $this->pupil->personalData->birthDate, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10,$this->lsize, _M('Naturalness',$this->module) . ':', '', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.40,$this->lsize, $this->pupil->personalData->naturalness, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10,$this->lsize, _M('Nacionality',$this->module) . ':', '', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15,$this->lsize, $this->pupil->personalData->nationality, 'R', null, 'R');
        $this->ln();

        /* Endereco */
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10, $this->lsize, _M('Address', $this->module) .':', 'L');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.40,$this->lsize, $this->pupil->personalData->location . ', ' . $this->pupil->personalData->number, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.07, $this->lsize, _M('Neighborhood', $this->module) .':', '');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.28,$this->lsize, $this->pupil->personalData->neighborhood, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.05,$this->lsize, _M('Zip code',$this->module) . ':', '', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10,$this->lsize, $this->pupil->personalData->zipcode, 'R', null, 'R');
        $this->ln();

        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.12, $this->lsize, _M('Complement', $this->module) .':', 'L');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.33,$this->lsize, $this->pupil->personalData->complement, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.07, $this->lsize, _M('City', $this->module) .':', '');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.28,$this->lsize, $this->pupil->personalData->city, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.05,$this->lsize, _M('State', 'basic') . ':', '', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15,$this->lsize, $this->pupil->personalData->state, 'R', null, 'R');
        $this->ln();
        //Telefone e email

        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.05, $this->lsize, _M('Email', $this->module) .':', 'LB');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.41,$this->lsize, strtolower($this->pupil->personalData->email), 'B');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.16, $this->lsize, _M('Residential phone', $this->module) .':', 'B');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.14,$this->lsize, $this->pupil->personalData->phone, 'B');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10,$this->lsize, _M('Cell phone', 'basic') . ':', 'B');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.14,$this->lsize, $this->pupil->personalData->cellphone, 'RB', null, 'R');
        $this->ln();



        $this->ln($this->lsize/3);
        /* Filiação de pessoa Linha 3*/
        /*$this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->SetFillColor(180,180,180);
        $this->cell(($this->psize)/5, $this->lsize, strtoupper(_M('Parents', $this->module)), 1, null, 'C', 1);
        $this->ln();*/

        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15,$this->lsize, _M('Father name', $this->module) . ':', 'LT');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.85,$this->lsize, $this->pupil->personalData->fatherName , 'RT');
        $this->ln();
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15,$this->lsize, _M('Mother name', $this->module). ':' , 'LB');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.85,$this->lsize, $this->pupil->personalData->motherName , 'RB');
        $this->ln();
        
        $this->ln($this->lsize/3);
        //Documentos 
        $this->setFont(DEFAULT_REPORT_FONT, 'B', 8);
        $this->SetFillColor(180,180,180);
        $this->cell($this->calcTextSize(strtoupper(_M('Documents', 'academic'))), $this->lsize, strtoupper(_M('Documents', 'academic')), 1, null, 'C', 1);
        $this->ln();

        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.17, $this->lsize, _M('CPF', $this->module) . ':', 'LT');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.83,$this->lsize, $this->pupil->documents->cpf->content, 'TR');
        $this->ln();

        /* Identidade, data de expedição, orgão de expedição Linha 4*/
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.17, $this->lsize, _M('Identity card', $this->module) . ':', 'L');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.18,$this->lsize, $this->pupil->documents->rg->content, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.12,$this->lsize, _M('Expedition date','basic') . ':', '', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.09,$this->lsize, $this->pupil->documents->rg->date, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.06,$this->lsize, _M('Organ','basic') . ':', '');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.19,$this->lsize, $this->pupil->documents->rg->organ, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15,$this->lsize, _M('UF','basic') . ':', '', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.04,$this->lsize, $this->pupil->documents->rg->uf, 'R');
        $this->ln();

        /* Reservista, caso seja homem */
        if ( strtoupper($this->pupil->personalData->sex) == 'MALE')
        {
            $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
            $this->cell(($this->psize)*0.125, $this->lsize, _M('Military service', $this->module) . ':', 'L');
            $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
            $this->cell(($this->psize)*0.475,$this->lsize, $this->pupil->documents->military->content, '');
            $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
            $this->cell(($this->psize)*0.12,$this->lsize, _M('Expedition date','basic') . ':', '', null, 'R');
            $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
            $this->cell(($this->psize)*0.09,$this->lsize, $this->pupil->documents->military->date, '');
            $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
            $this->cell(($this->psize)*0.15,$this->lsize, _M('UF','basic') . ':', '', null, 'R');
            $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
            $this->cell(($this->psize)*0.04,$this->lsize, $this->pupil->documents->military->uf, 'R');
            $this->ln();
        }

        /* Titulo de eleitor*/
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.125, $this->lsize, _M('Evidence of voter', $this->module) . ':', 'LB');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.475,$this->lsize, $this->pupil->documents->electoral->content, 'B');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.12,$this->lsize, _M('Expedition date','basic') . ':', 'B', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.09,$this->lsize, $this->pupil->documents->electoral->date, 'B');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15,$this->lsize, _M('UF','basic') . ':', 'B', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.04,$this->lsize, $this->pupil->documents->electoral->uf, 'RB');
        $this->ln();

        $this->ln($this->lsize/3);
        //Local de trabalho
        
        $this->setFont(DEFAULT_REPORT_FONT, 'B', 8);
        $this->SetFillColor(180,180,180);
        $this->cell($this->calcTextSize( strtoupper(_M('Work data', 'academic'))), $this->lsize, strtoupper(_M('Work data', 'academic')), 1, null, 'C', 1);
        $this->ln();
        
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.1, $this->lsize, _M('Name', $this->module) . ':', 'LT');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.64, $this->lsize, $this->pupil->workData->name, 'T');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.1, $this->lsize, _M('Phone', $this->module) . ':', 'T');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.16, $this->lsize, $this->pupil->workData->phone, 'TR', null, 'R');
        $this->ln();

        /* Endereco de trabalho */
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10, $this->lsize, _M('Address', $this->module) .':', 'L');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.40,$this->lsize, $this->pupil->workData->location , '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.07, $this->lsize, _M('Neighborhood', $this->module) .':', '');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.28,$this->lsize, $this->pupil->workData->neighborhood, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.05,$this->lsize, _M('Zip code',$this->module) . ':', '', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10,$this->lsize, $this->pupil->workData->zipcode, 'R', null, 'R');
        $this->ln();

        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.12, $this->lsize, _M('Complement', $this->module) .':', 'LB');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.33,$this->lsize, $this->pupil->workData->complement, 'B');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.07, $this->lsize, _M('City', $this->module) .':', 'B');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.28,$this->lsize, $this->pupil->workData->city, 'B');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.05,$this->lsize, _M('State', 'basic') . ':', 'B', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15,$this->lsize, $this->pupil->workData->state, 'RB', null, 'R');
        $this->ln();
        
        $this->ln($this->lsize/3);

        /* Ensino médio ou equivalente */
        $this->setFont(DEFAULT_REPORT_FONT, 'B', 8);
        $this->SetFillColor(180,180,180);
        $this->cell($this->calcTextSize( strtoupper(_M('School data', 'academic')) ), $this->lsize, strtoupper(_M('School data', 'academic')), 1, null, 'C', 1);
        $this->ln();

        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15, $this->lsize, _M('Type', $this->module) .':', 'LT');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.85,$this->lsize, $this->pupil->schoolData->courseType, 'TR');
        $this->ln();

        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);
        $this->cell(($this->psize)*0.15,$this->lsize, _M('Establishment',$this->module) . ':', 'L');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.85,$this->lsize, $this->pupil->schoolData->school, 'R');
        $this->ln();

        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15,$this->lsize, _M('Conclusion year',$this->module) . ':', 'BL');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.05,$this->lsize, $this->pupil->schoolData->conclusionYear, 'B');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10,$this->lsize, _M('City','basic'). ':', 'B', null);
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.60,$this->lsize, $this->pupil->schoolData->city, 'B');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.06,$this->lsize, _M('UF','basic'). ':', 'B', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.04,$this->lsize, $this->pupil->schoolData->uf, 'BR');
        $this->ln();         

        $this->ln($this->lsize/3);

        $this->getDocumentData();

        $this->getResponsable();
        //Termo de responsabilidade
        if ( defined('STATEMENT_OF_RESPONSIBILITY_TEXT') && strlen((string)STATEMENT_OF_RESPONSIBILITY_TEXT) > 0 )
        {
            $this->setFont(DEFAULT_REPORT_FONT, 'B', 8);
            $this->SetFillColor(180,180,180);
            $this->cell($this->calcTextSize(strtoupper(_M('Statement of responsibility', 'academic' ))), $this->lsize, strtoupper(_M('Statement of responsibility', 'academic')), 1, null, 'C', 1);
            $this->ln();
            $this->cell($this->psize, 1, null, 'TRL');
            $this->ln();
            $this->setFont(DEFAULT_REPORT_FONT, '', 7);
            $this->multicell($this->psize, $this->lsize, STATEMENT_OF_RESPONSIBILITY_TEXT, 'LR');
            $this->setFont(DEFAULT_REPORT_FONT, 'B', 8);
            $this->cell(($this->psize/2), $this->lsize, $this->pdfInfo->cityName . '/' . $this->pdfInfo->stateId .'     '. date('d/m/Y'), 'L', null, 'C');
            $this->cell(($this->psize/2), $this->lsize, '___________________________________________', 'R', null, 'C');
            $this->ln();
            $this->cell(($this->psize/2), $this->lsize/2, null, 'L', null, 'C');
            $this->cell(($this->psize/2), $this->lsize/2, 'Assinatura do Aluno ou Responsável', 'R', null, 'C');
            $this->ln();
            $this->cell($this->psize, 1, null, 'BRL');
            $this->ln();
        }
        $this->setFont(DEFAULT_REPORT_FONT, 'B', 8);
        $this->ln();
        $this->cell($this->psize, $this->lsize, null, 'TRL');
        $this->ln();
        $this->cell(($this->psize), $this->lsize, '__________________________________________________', 'RL', null, 'C');
        $this->ln();
        $this->cell(($this->psize), $this->lsize, 'Assinatura do Responsável pela Matrícula', 'LR', null, 'C');
        $this->ln();
        $this->cell($this->psize, 1, null, 'BRL');
        $this->ln();
        

    }

    public function getDocumentData()
    {
        $MIOLO = MIOLO::getInstance();
        $busDocumentType = $MIOLO->getBusiness('basic', 'BusDocumentType');
        $busDocument = $MIOLO->getBusiness('basic', 'BusDocument');
        $data->sex = $this->pupil->sexCharId;
        $data->age = $this->pupil->age;
        $data->personType = 'P';
        $data->needDeliver = DB_TRUE;

        $searchDocument         = $busDocumentType->searchDocumentType($data);
        $searchDocumentPerson   = $busDocument->searchDocument($this->pupil->personalData);
        if ( count($searchDocument) == 0 )
        {
            return ;
        }
        for ( $x = 0; $x < count($searchDocument); $x++)
        {
            $documents[$searchDocument[$x][0]] = $this->calcTextSize($searchDocument[$x][1]);
            $searchDocument2[$searchDocument[$x][0]] = $searchDocument[$x];
        }
        
        arsort($documents);
        
        $x=0;
        $r = count($documents)%3;
        $l = floor(count($documents)/3);
        foreach ( $documents as $item => $value )
        {
            if ( $x < ($l+($r > 0 ? 1 :0)) )
            {
                $a['max'][$x] = $item;
            }
            else if ( $x < (($l*2)+($r > 0 ? $r :0)) )
            {
                $a['med'][$x] = $item;
            }
            else
            {
                $a['min'][$x] = $item;
            }
            $x++;
        }
     
        //Dados pessoais 
        $this->setFont(DEFAULT_REPORT_FONT, 'B', 8);
        $this->SetFillColor(180,180,180);
        $this->cell($this->calcTextSize( strtoupper(_M('Delivered documents', 'academic')) ), $this->lsize, strtoupper(_M('Delivered documents', 'academic')), 1, null, 'C', 1);
        $this->ln();

        $this->setFont(DEFAULT_REPORT_FONT, '', 8);         
        $ab['y'] = $this->y;
        $ab['x'] = $this->x;
        $this->SetDrawColor(0);
        $this->SetFillColor(180);
        
        $x = 0;

        foreach ( $a['max'] as $item => $value )
        {
            $fill = false;
            for( $z = 0; $z < count($searchDocumentPerson); $z++)
            { 
                if ( $searchDocumentPerson[$z][2] == $value && $searchDocumentPerson[$z][5] == DB_TRUE )
                {
                    $fill = 'FD';
                }
            }
            $this->x = $this->x+1;
            $this->Rect( $this->x, $this->y+0.4, $this->lsize-1, $this->lsize-1, $fill);
            $this->x = ( $this->x + 3 );
            $this->cell( $this->calcTextSize($searchDocument2[$value][1]), $this->lsize, $searchDocument2[$value][1]);
            if ( $x == 0 )
            {
                $posX = $this->x;
            }
            $x++;
            $this->Ln();
        }

        $this->y = $ab['y'];
        $x = 0;
        
        if ( count($a['med']) > 0 )
        {
            foreach ( $a['med'] as $item => $value )
            {
                $fill = false;
                for( $z = 0; $z < count($searchDocumentPerson); $z++)
                { 
                    if ( $searchDocumentPerson[$z][2] == $value && $searchDocumentPerson[$z][5] == DB_TRUE )
                    {
                        $fill = 'FD';
                    }
                }
                $this->x = $posX;
                $this->x = $this->x+1;
                $this->Rect( $this->x, $this->y+0.4, $this->lsize-1, $this->lsize-1, $fill);
                $this->x = ( $this->x + 3 );
                $this->cell( $this->calcTextSize($searchDocument2[$value][1]), $this->lsize, $searchDocument2[$value][1]);
                if ( $x == 0 )
                {
                    $posX2 = $this->x;
                }
                $x++;
                $this->Ln();
            }
        }
        $this->y = $ab['y'];
        $x = 0;
        if ( count ($a['min']) > 0 )
        {
            foreach ( $a['min'] as $item => $value )
            {
                $fill = false;
                for( $z = 0; $z < count($searchDocumentPerson); $z++)
                { 
                    if ( $searchDocumentPerson[$z][2] == $value && $searchDocumentPerson[$z][5] == DB_TRUE )
                    {
                        $fill = 'FD';
                    }   
                }
                $this->x = $posX2;
                $this->x = $this->x+1;
                $this->Rect( $this->x, $this->y+0.4, $this->lsize-1, $this->lsize-1, $fill);
                $this->x = ( $this->x + 3 );
                $this->cell( $this->calcTextSize($searchDocument2[$value][1]), $this->lsize, $searchDocument2[$value][1]);
                if ( $x == 0 )
                {
                    $posX3 = $this->x;
                }
                $x++;
                $this->Ln();
            }
    
        }
        
        if ( $r > 0 )
        {
            $this->Ln();
        }

        $this->Line($ab['x'], $ab['y'], $ab['x']+$this->psize, $ab['y']);
        $this->Line($ab['x'], $ab['y'], $ab['x'], $this->y);
        $this->Line($ab['x'], $this->y, $ab['x']+$this->psize, $this->y);
        $this->Line($ab['x']+$this->psize, $ab['y'], $ab['x']+$this->psize, $this->y);
        
        $preehcnerObservacoes = false;
        for ( $x = 0; $x < count($searchDocument); $x++)
        {
            if ( strlen((string)$searchDocument[$x][6]) > 0 )
            {
                $preencherObservacoes = true;
            }
        }
        $this->setFont(DEFAULT_REPORT_FONT, '', 8);         

        if ( $preencherObservacoes == true )
        {
            //Dados pessoais
            $this->ln($this->lsize/3);
            $this->setFont(DEFAULT_REPORT_FONT, 'B', 8);
            $this->SetFillColor(180,180,180);
            $this->cell($this->calcTextSize( strtoupper(_M('Observations', 'academic')) ), $this->lsize, strtoupper(_M('Observations', 'academic')), 1, null, 'C', 1);
            $this->ln();
            $ab['y'] = $this->y;
            $ab['x'] = $this->x;
            $this->SetDrawColor(0);
            $this->SetFillColor(180);
            
            for ( $x = 0; $x < count($searchDocument); $x++)
            {
                if ( strlen((string)$searchDocument[$x][6]) > 0 )
                {
                    $this->setFont(DEFAULT_REPORT_FONT, 'B', 7);         
                    $this->cell( $this->calcTextSize($searchDocument[$x][1]), $this->lsize, $searchDocument[$x][1] . ':' );
                    $this->setFont(DEFAULT_REPORT_FONT, '', 7);         
                    $this->MultiCell($this->psize - ($this->calcTextSize($searchDocument[$value][1])+7), $this->lsize, $searchDocument[$x][6], 'J');
                }
            }
            $this->Line($ab['x'], $ab['y'], $ab['x']+$this->psize, $ab['y']);
            $this->Line($ab['x'], $ab['y'], $ab['x'], $this->y);
            $this->Line($ab['x'], $this->y, $ab['x']+$this->psize, $this->y);
            $this->Line($ab['x']+$this->psize, $ab['y'], $ab['x']+$this->psize, $this->y);
        }

          
        //y = 
        //x = largura
        //Rect($x: float, $y: float, $w: float, $h: float, $style: string, $border_style: array, $fill_color: array)
        $this->ln( $this->lsize/3 );
    }

    public function calcTextSize($text)
    {
        return $this->GetStringWidth($text)+5;
    }

    public function getResponsable()
    {
        if ( strlen((string)$this->pupil->responsableData->cpf) == 0 || ($this->pupil->responsableData->cpf == $this->pupil->documents->cpf->content) )
        {
            return ;
        }
            //Dados do fiador 
        $this->setFont(DEFAULT_REPORT_FONT, 'B', 8);
        $this->SetFillColor(180,180,180);
        $this->cell($this->calcTextSize(strtoupper(_M('Responsable data', 'academic'))), $this->lsize, strtoupper(_M('Responsable data', $this->module)), 1, null, 'C', 1);
        $this->ln();
        /* Nome e código de pessoa Linha 1*/
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.1, $this->lsize, _M('Name', $this->module) . ':', 'LT');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.45, $this->lsize, $this->pupil->responsableData->name, 'T');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.05, $this->lsize, _M('Sex', $this->module) . ':', 'T', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.1, $this->lsize, _M($this->pupil->responsableData->sex, $this->module), 'T', null);
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15, $this->lsize, _M('Marital status', $this->module) .':', 'T', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15,$this->lsize, $this->pupil->responsableData->marital, 'TR', null, 'R');
        $this->ln();

        /* Data de nascimento, naturalidade e nacionalidade de pessoa Linha 3*/
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15, $this->lsize, _M('Birth date', $this->module) .':', 'L');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10,$this->lsize, $this->pupil->responsableData->birthDate, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10,$this->lsize, _M('Naturalness',$this->module) . ':', '', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.40,$this->lsize, $this->pupil->responsableData->naturalness, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10,$this->lsize, _M('Nacionality',$this->module) . ':', '', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15,$this->lsize, $this->pupil->responsableData->nationality, 'R', null, 'R');
        $this->ln();

        /* Endereco */
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10, $this->lsize, _M('Address', $this->module) .':', 'L');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.40,$this->lsize, $this->pupil->responsableData->location . ', ' . $this->pupil->responsableData->number, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.07, $this->lsize, _M('Neighborhood', $this->module) .':', '');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.28,$this->lsize, $this->pupil->responsableData->neighborhood, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.05,$this->lsize, _M('Zip code',$this->module) . ':', '', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10,$this->lsize, $this->pupil->responsableData->zipcode, 'R', null, 'R');
        $this->ln();

        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.12, $this->lsize, _M('Complement', $this->module) .':', 'L');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.33,$this->lsize, $this->pupil->responsableData->complement, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.07, $this->lsize, _M('City', $this->module) .':', '');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.40,$this->lsize, $this->pupil->responsableData->city, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.04,$this->lsize, _M('UF', 'basic') . ':', '', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.04,$this->lsize, $this->pupil->responsableData->uf, 'R', null, 'R');
        $this->ln();
        //Telefone e email

        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.05, $this->lsize, _M('Email', $this->module) .':', 'L');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.41,$this->lsize, strtolower($this->pupil->responsableData->email), '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.16, $this->lsize, _M('Residential phone', $this->module) .':', '');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.14,$this->lsize, $this->pupil->responsableData->phone, '');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.10,$this->lsize, _M('Cell phone', 'basic') . ':', '');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.14,$this->lsize, $this->pupil->responsableData->cellphone, 'R', null, 'R');
        $this->ln();

        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.17, $this->lsize, _M('CPF', $this->module) . ':', 'L');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.83,$this->lsize, $this->pupil->responsableData->cpf, 'R');
        $this->ln();

        /* Identidade, data de expedição, orgão de expedição Linha */
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.17, $this->lsize, _M('Identity card', $this->module) . ':', 'LB');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.18,$this->lsize, $this->pupil->responsableData->rg, 'B');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.12,$this->lsize, _M('Expedition date','basic') . ':', 'B', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.09,$this->lsize, $this->pupil->responsableData->rgDate, 'B');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.06,$this->lsize, _M('Organ','basic') . ':', 'B');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.19,$this->lsize, $this->pupil->responsableData->rgOrgan, 'B');
        $this->setFont(DEFAULT_REPORT_FONT, 'B', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.15,$this->lsize, _M('UF','basic') . ':', 'B', null, 'R');
        $this->setFont(DEFAULT_REPORT_FONT, '', $this->defaultFontSize);         
        $this->cell(($this->psize)*0.04,$this->lsize, $this->pupil->responsableData->rgUf, 'RB');
        $this->ln();

        $this->ln($this->lsize/3);
    }
    public function Footer()
    {
        $this->setY(-15);
        $pn = $this->PageNo();
        $this->cell($this->psize, $this->lsize, '', 'B', 1);
        $this->ln(); 
		$this->setFont(DEFAULT_REPORT_FONT, 'I', 8);
		$this->cell(($this->psize/6), $this->lsize, $this->title,  0, 0, 'L');
   		$this->setFont(DEFAULT_REPORT_FONT, 'BI', 8);
		$this->cell(($this->psize/6)*4, $this->lsize, $this->pupil->personalData->name , 0, 0, 'C');
   		$this->setFont(DEFAULT_REPORT_FONT, 'I', 8);
   		$this->cell(($this->psize/6), $this->lsize, _M('Page @1', $this->module, $pn), 0, 0, 'R');
        $this->ln();
    }
}
?>
