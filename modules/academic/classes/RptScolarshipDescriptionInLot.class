<?php

$MIOLO = MIOLO::getInstance();
$MIOLO->Uses('classes/RptScolarshipDescription.class', 'academic');

class RptScolarshipDescriptionInLot extends RptScolarshipDescription 
{
    public function __construct($data = NULL)
    {
        $MIOLO = MIOLO::getInstance();
        $this->db = $MIOLO->getBusiness('academic', 'BusScolarshipDescription');
        $this->title = strtoupper(_M('Scolarship description', $this->module));
        PDF::__construct();
        $this->aliasNbPages();
        $this->defaultFontSize = 8;
        foreach ($data as $item=> $value)
        {
            $this->contracts->{$item} = $value;
        }
        $pupils = $this->db->getClassPupils($this->contracts); 
        if(count($pupils) == 0 ) { return; }
        foreach ($pupils as $pupil)
        {
            unset($this->contract);
            $this->contract = $pupil;
            $this->contract->notPrintEnrolled       = $this->contracts->notPrintEnrolled;
            $this->contract->notPrintDisapproved    = $this->contracts->notPrintDisapproved;
            $this->contract->printNotCoursed        = $this->contracts->printNotCoursed;
            $this->curriculum = $this->db->getCurriculum($this->contract);
            $this->useUserInfo = true;
            $this->addPage('P', 'mm', 'A4');
            $this->atualPage = $this->PageNo()-1;
            $this->oldPersonName = $pupil->personName;
            foreach($this->contracts as $item => $value)
            {
                $this->contract->{$item} = $value;
            }
            $this->putHeaderLine();
            unset($this->contract);
        }
        $this->outPut();
    }
    public function Footer()
    {
        $this->setY(-15);
        $pn = $this->PageNo()-$this->atualPage;
        $this->cell($this->psize, $this->lsize, '', 'B', 1);
        $this->ln(); 
		$this->setFont(DEFAULT_REPORT_FONT, 'I', 8);
		$this->cell(($this->psize/6), $this->lsize, $this->title,  0, 0, 'L');
   		$this->setFont(DEFAULT_REPORT_FONT, 'BI', 8);
		$this->cell(($this->psize/6)*4, $this->lsize, $this->oldPersonName , 0, 0, 'C');
   		$this->setFont(DEFAULT_REPORT_FONT, 'I', 8);
   		$this->cell(($this->psize/6), $this->lsize, _M('Page @1', $this->module, $pn), 0, 0, 'R');
        $this->ln();
    }
}
?>
