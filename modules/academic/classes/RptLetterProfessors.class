<?php

/**
 * Default defines 
 * To report identification
 */
define('REPORT_ID', 'AC004'); 
define('FPDF_FONTPATH', $MIOLO->getModulePath('basic', '/classes/fpdf/font/'));


/**
 * Definições para margens da página - Folha A4 //A4 tem 210 mm de largura e 297 mm
 *
*/
define('superiorMargin', '15');
define('leftMargin', '25');
define('rightMargin', '190');
define('inferiorMargin', '277');


$MIOLO = MIOLO::getInstance();
$module = MIOLO::getCurrentModule();
$MIOLO->Uses('classes/fpdf/fpdf.php', 'basic');

/**
 * Create header and footer information
 */
class PDF extends FPDF
{

    var $type = 0;
    /**
     * Defines the footer for this report
     */
    public function Footer()
    {


    }

    /**
     * Defines the header for this report
     */
    public function Header()
    {
        $module = MIOLO::getCurrentModule();
        $MIOLO  = MIOLO::getInstance();

        $busCompany  = $MIOLO->getBusiness('basic', 'BusCompany');
        $company     = $busCompany->getCompany(DEFAULT_COMPANY_CONF);     //get company data

        $this->Image(SAGUFile::getPhotoPath($company->personId), rightMargin-30, superiorMargin, 30, PHOTO_FORMAT);
    }
}


/**
 * PDF extension to generate report
 */
class RptLetterProfessors
{
    /**
     * Method to generate the report
     */
    public function RptLetterProfessors($data = null)
    {
        $MIOLO       = MIOLO::getInstance();
        $module      = MIOLO::getCurrentModule();

        $businessCompany = $MIOLO->getBusiness('basic', 'BusCompany');
        $company         = $businessCompany->getCompany(DEFAULT_COMPANY_CONF);

        $businessLegalPerson = $MIOLO->getBusiness('basic', 'BusLegalPerson');
        $legalPerson         = $businessLegalPerson->getLegalPerson($company->personId);

        $businessCity = $MIOLO->getBusiness('basic', 'BusCity');
        $city         = $businessCity->getCity($legalPerson->cityId);

     if($data->typeGenerationS == '1')
     {
        //get the business classes wich will be used to generate the PDF file
        $business    = $MIOLO->getBusiness($module, 'BusLetterProfessors');
        $reportData  = $business->listDateToLetterProfessor($data->periodId, $data->professorIdS);

        // Generating PDF file
        $pdf = new PDF();
        $pdf->aliasNbPages();

        // First page
        $pdf->addPage('P', 'mm', 'A4');

        $pdf->setFont(DEFAULT_REPORT_FONT, '', 11);

        $businessCompany = $MIOLO->getBusiness('basic', 'BusCompany');
        $company         = $businessCompany->getCompany(DEFAULT_COMPANY_CONF);

        $pdf->setY(superiorMargin);
        $pdf->ln(20);
        $pdf->setX(20);
        $pdf->cell(righMargin, 0,'Ofício Circular '. $data->oficioNumberS . ' /PROEN/' . $company->name, 0, 0, 'L');

        $pdf->ln(8);
        $actualDate = SAGU::getCapitulatetString($city->name) . ', ' . SAGU::getDateByExtense(date(MASK_DATE_PHP));
        $pdf->cell(182, 0, $actualDate, 0, 0, 'R');

        $pdf->ln(15);
        $pdf->setX(35);
        $pdf->cell(leftRight, 0, 'Senhor(a) Professor(a)', 0, 0, 'L');

        $pdf->ln(15);
        $pdf->setX(35);
        $pdf->cell(leftRight, 0, '         Temos a satisfação de cumprimentá-lo por ocasião do início letivo '.$data->periodId.' e manifestar', 0, 0, 'L');

        $busCompany  = $MIOLO->getBusiness('basic', 'BusCompany');
        $company     = $busCompany->getCompany(DEFAULT_COMPANY_CONF);

        $pdf->ln(6);
        $pdf->setX(20);
        $pdf->cell(leftRight, 0, 'a satisfação de poder contar com seus trabalhos na ' . $company->name . '. ', 0, 0, 'L');

        $pdf->ln(8);
        $pdf->setX(35);
        $pdf->cell(leftRight, 0, '         Aproveitamos a oportunidade para informar que o início das aulas está previsto para o ', 0, 0, 'L');

        $pdf->ln(6);
        $pdf->setX(20);
        $pdf->cell(leftRight, 0, 'dia 22 de fevereiro, terça-feira. E que, no dia anterior, 21, às 19:30, haverá reunião geral para os pro- ', 0, 0, 'L');

        $pdf->ln(6);
        $pdf->setX(20);
        $pdf->cell(leftRight, 0, 'fessores no auditório do Prédio 7. ', 0, 0, 'L');

        $busCompany  = $MIOLO->getBusiness('basic', 'BusCompany');
        $company     = $busCompany->getCompany(DEFAULT_COMPANY_CONF);

        $pdf->ln(8);
        $pdf->setX(35);
        $pdf->cell(leftRight, 0, '         Concluída a matrícula em todos os cursos da ' . $company->name . ', contamos com seus trabalhos  ', 0, 0, 'L');

        $pdf->ln(6);
        $pdf->setX(20);
        $pdf->cell(leftRight, 0, 'de docência no semestre. '.$data->periodId.' nas seguintes disciplinas:', 0, 0, 'L');

        $pdf->ln(6);
        $pdf->line(20, $pdf->getY(), 198, $pdf->getY());

        $pdf->ln(3);
        $pdf->setX(20);
        $pdf->cell(leftRight, 0, 'Dia Turno Sala-Prédio    Início aulas    Alunos   Unidade      Disciplina                                           Curso   ', 0, 0, 'L');

        $pdf->ln(2);
        $pdf->line(20, $pdf->getY(), 198, $pdf->getY());


        $lineToGroups = $pdf->getY();

        if(count($reportData) > 0)
        {
           foreach ($reportData as $row)
            {
                $pdf->ln(5);
                $pdf->setFont(DEFAULT_REPORT_FONT, '', 11);                
            //    $pdf->setX(25);
            //    $pdf->cell(leftRight, 0, $row[6].'  '.$row[8].'     '.$row[9].'-'.$row[10].'  '.$row[11].'  '.'Unidade'.'  '.$row[5].'  '.'Curso', 0, 0, 'L');

                $pdf->setX(20);
                $pdf->cell(leftRight, 0, $row[6], 0, 0, 'L');

                $pdf->setX(30);
                $pdf->cell(leftRight, 0, '  '.$row[8], 0, 0, 'L');

                $pdf->setX(40);
                $pdf->cell(leftRight, 0, '  '.$row[9].'-'.$row[10], 0, 0, 'L');

                $pdf->setX(60);
                $pdf->cell(leftRight, 0, '  '.$row[11], 0, 0, 'L');

                $pdf->setX(88);
                $pdf->cell(leftRight, 0, '  '.$row[15], 0, 0, 'L');

                $pdf->setX(100);
                $pdf->cell(leftRight, 0, '  '.$row[13], 0, 0, 'L');

                $pdf->setX(120);
                $pdf->cell(leftRight, 0, '   '.$row[5], 0, 0, 'L');

                $pdf->setX(183);
                $pdf->cell(leftRight, 0, '   '.$row[14], 0, 0, 'L');

            }
        }

        $pdf->ln(2);
        $pdf->line(20, $pdf->getY(), 198, $pdf->getY());


        $pdf->ln(6);
        $pdf->setX(35);
        $pdf->cell(leftRight, 0, '         O número de alunos acima mencionado pode sofrer alguma alteração em conseqüência ', 0, 0, 'L');

        $pdf->ln(6);
        $pdf->setX(20);
        $pdf->cell(leftRight, 0, 'de ajuste de matrículas. Aproveitamos para lembrar que disciplinas de 4 créditos correspondem a 16', 0, 0, 'L');

        $pdf->ln(6);
        $pdf->setX(20);
        $pdf->cell(leftRight, 0, 'turnos de aula, a serem cumpridos nos seguintes horários:', 0, 0, 'L');

        $pdf->ln(8);
        $pdf->setX(35);
        $pdf->cell(leftRight, 0, '         Manhã: 8h20min às 11h55min                        Intervalo:10h às 10:15min', 0, 0, 'L');

        $pdf->ln(8);
        $pdf->setX(35);
        $pdf->cell(leftRight, 0, '         Noite: 19h15min às 22h30min                         Intervalo:20h45min às 21h', 0, 0, 'L');

        $pdf->ln(8);
        $pdf->setX(35);
        $pdf->cell(leftRight, 0, '         Disciplinas com outro número de créditos seguem a norma básica correspondente.', 0, 0, 'L');

        $pdf->ln(8);
        $pdf->setX(35);
        $pdf->cell(leftRight, 0, '         Solicitamos que os conteúdos programáticos sejam entregues na secretaria dos cursos até', 0, 0, 'L');

        $pdf->ln(6);
        $pdf->setX(20);
        $pdf->cell(leftRight, 0, 'o dia 15 de fevereiro de 2005.', 0, 0, 'L');

        $pdf->ln(8);
        $pdf->setX(35);
        $pdf->cell(leftRight, 0, '         Com os votos de um bom período de recesso e excelente reinício dos trabalhos na', 0, 0, 'L');

        $busCompany  = $MIOLO->getBusiness('basic', 'BusCompany');
        $company     = $busCompany->getCompany(DEFAULT_COMPANY_CONF);

        $pdf->ln(6);
        $pdf->setX(20);
        $pdf->cell(leftRight, 0, $company->name . '.', 0, 0, 'L');

        $pdf->ln(8);
        $pdf->setX(35);
        $pdf->cell(leftRight, 0, '         Atenciosamente                                                                                     Pró-Reitoria e', 0, 0, 'L');

        $pdf->ln(6);
        $pdf->setX(35);
        $pdf->cell(leftRight, 0, '                                                                                                                  Secretaria de Ensino', 0, 0, 'L');


        $pdf->ln(6);
        $pdf->setX(20);
        $pdf->cell(leftRight, 0, 'Senhor (a)', 0, 0, 'L');

        $pdf->ln(6);
        $pdf->setX(20);
        $pdf->cell(leftRight, 0, ''.$row[0], 0, 0, 'L');

        $pdf->ln(6);
        $pdf->setX(20);
        $pdf->cell(leftRight, 0, ''.$row[2].' - '.$row[3], 0, 0, 'L');

        $pdf->ln(6);
        $pdf->setX(20);
        $pdf->cell(leftRight, 0, ''.$row[4], 0, 0, 'L');

        $pdf->ln(6);
        $pdf->setX(20);
        $pdf->cell(leftRight, 0, ''.$row[12].' - '.$row[1], 0, 0, 'L');
    }

    if($data->typeGenerationS == '2')
    {
        $business    = $MIOLO->getBusiness($module, 'BusLetterProfessors');
        $reportData  = $business->listAllProfessorsFromPeriod($data->periodId);

        // Generating PDF file
        $pdf = new PDF();
        $pdf->aliasNbPages();

        if(count($reportData) > 0)
        {
            foreach ($reportData as $row1)
            {
               $pdf->addPage('P', 'mm', 'A4');

                $pdf->setFont(DEFAULT_REPORT_FONT, '', 11);

                $busCompany  = $MIOLO->getBusiness('basic', 'BusCompany');
                $company     = $busCompany->getCompany(DEFAULT_COMPANY_CONF);

                $pdf->setY(superiorMargin);
                $pdf->ln(20);
                $pdf->setX(20);
                $pdf->cell(righMargin, 0,'Ofício Circular '. $data->oficioNumberS . ' /PROEN/' . $company->name, 0, 0, 'L');
        
                $pdf->ln(8);
                $actualDate = SAGU::getCapitulatetString($city->name) . ', ' . SAGU::getDateByExtense(date(MASK_DATE_PHP));
                $pdf->cell(182, 0, $actualDate, 0, 0, 'R');
        
                $pdf->ln(15);
                $pdf->setX(35);
                $pdf->cell(leftRight, 0, 'Senhor(a) Professor(a)', 0, 0, 'L');
        
                $pdf->ln(15);
                $pdf->setX(35);
                $pdf->cell(leftRight, 0, '         Temos a satisfação de cumprimentá-lo por ocasião do início letivo '.$data->periodId.' e manifestar', 0, 0, 'L');

                $busCompany  = $MIOLO->getBusiness('basic', 'BusCompany');
                $company     = $busCompany->getCompany(DEFAULT_COMPANY_CONF);
        
                $pdf->ln(6);
                $pdf->setX(20);
                $pdf->cell(leftRight, 0, 'a satisfação de poder contar com seus trabalhos na ' . $company->name . '. ', 0, 0, 'L');
        
                $pdf->ln(8);
                $pdf->setX(35);
                $pdf->cell(leftRight, 0, '         Aproveitamos a oportunidade para informar que o início das aulas está previsto para o ', 0, 0, 'L');
        
                $pdf->ln(6);
                $pdf->setX(20);
                $pdf->cell(leftRight, 0, 'dia 22 de fevereiro, terça-feira. E que, no dia anterior, 21, às 19:30, haverá reunião geral para os pro- ', 0, 0, 'L');
        
                $pdf->ln(6);
                $pdf->setX(20);
                $pdf->cell(leftRight, 0, 'fessores no auditório do Prédio 7. ', 0, 0, 'L');

                $busCompany  = $MIOLO->getBusiness('basic', 'BusCompany');
                $company     = $busCompany->getCompany(DEFAULT_COMPANY_CONF);

                $pdf->ln(8);
                $pdf->setX(35);
                $pdf->cell(leftRight, 0, '         Concluída a matrícula em todos os cursos da ' . $company->name . ', contamos com seus trabalhos  ', 0, 0, 'L');

                $pdf->ln(6);
                $pdf->setX(20);
                $pdf->cell(leftRight, 0, 'de docência no semestre. '.$data->periodId.' nas seguintes disciplinas:', 0, 0, 'L');
        
                $pdf->ln(6);
                $pdf->line(20, $pdf->getY(), 198, $pdf->getY());

                $pdf->ln(3);
                $pdf->setX(20);
                $pdf->cell(leftRight, 0, 'Dia Turno Sala-Prédio    Início aulas    Alunos   Unidade      Disciplina                                           Curso   ', 0, 0, 'L');

                $pdf->ln(2);
                $pdf->line(20, $pdf->getY(), 198, $pdf->getY());


                $lineToGroups = $pdf->getY();


                $business    = $MIOLO->getBusiness($module, 'BusLetterProfessors');
                $reportData2  = $business->listDateToLetterProfessor($data->periodId, $row1[0]);

                if(count($reportData2) > 0)
                {
                   foreach ($reportData2 as $row2)
                   {
                        $pdf->ln(5);
                        $pdf->setFont(DEFAULT_REPORT_FONT, '', 11);                
                    //    $pdf->setX(25);
                    //    $pdf->cell(leftRight, 0, $row[6].'  '.$row[8].'     '.$row[9].'-'.$row[10].'  '.$row[11].'  '.'Unidade'.'  '.$row[5].'  '.'Curso', 0, 0, 'L');
        
                        $pdf->setX(20);
                        $pdf->cell(leftRight, 0, $row2[6], 0, 0, 'L');
        
                        $pdf->setX(30);
                        $pdf->cell(leftRight, 0, '  '.$row2[8], 0, 0, 'L');
        
                        $pdf->setX(40);
                        $pdf->cell(leftRight, 0, '  '.$row2[9].'-'.$row2[10], 0, 0, 'L');

                        $pdf->setX(60);
                        $pdf->cell(leftRight, 0, '  '.$row2[11], 0, 0, 'L');
        
                        $pdf->setX(88);
                        $pdf->cell(leftRight, 0, '  '.$row2[15], 0, 0, 'L');
        
                        $pdf->setX(100);
                        $pdf->cell(leftRight, 0, '  '.$row2[13], 0, 0, 'L');
        
                        $pdf->setX(120);
                        $pdf->cell(leftRight, 0, '   '.$row2[5], 0, 0, 'L');
        
                        $pdf->setX(183);
                        $pdf->cell(leftRight, 0, '   '.$row2[14], 0, 0, 'L');
                    }
                }

                $pdf->ln(2);
                $pdf->line(20, $pdf->getY(), 198, $pdf->getY());
        
        
                $pdf->ln(6);
                $pdf->setX(35);
                $pdf->cell(leftRight, 0, '         O número de alunos acima mencionado pode sofrer alguma alteração em conseqüência ', 0, 0, 'L');
        
                $pdf->ln(6);
                $pdf->setX(20);
                $pdf->cell(leftRight, 0, 'de ajuste de matrículas. Aproveitamos para lembrar que disciplinas de 4 créditos correspondem a 16', 0, 0, 'L');
        
                $pdf->ln(6);
                $pdf->setX(20);
                $pdf->cell(leftRight, 0, 'turnos de aula, a serem cumpridos nos seguintes horários:', 0, 0, 'L');
        
                $pdf->ln(8);
                $pdf->setX(35);
                $pdf->cell(leftRight, 0, '         Manhã: 8h20min às 11h55min                        Intervalo:10h às 10:15min', 0, 0, 'L');
        
                $pdf->ln(8);
                $pdf->setX(35);
                $pdf->cell(leftRight, 0, '         Noite: 19h15min às 22h30min                         Intervalo:20h45min às 21h', 0, 0, 'L');
        
                $pdf->ln(8);
                $pdf->setX(35);
                $pdf->cell(leftRight, 0, '         Disciplinas com outro número de créditos seguem a norma básica correspondente.', 0, 0, 'L');
        
                $pdf->ln(8);
                $pdf->setX(35);
                $pdf->cell(leftRight, 0, '         Solicitamos que os conteúdos programáticos sejam entregues na secretaria dos cursos até', 0, 0, 'L');
        
                $pdf->ln(6);
                $pdf->setX(20);
                $pdf->cell(leftRight, 0, 'o dia 15 de fevereiro de 2005.', 0, 0, 'L');
        
                $pdf->ln(8);
                $pdf->setX(35);
                $pdf->cell(leftRight, 0, '         Com os votos de um bom período de recesso e excelente reinício dos trabalhos na', 0, 0, 'L');

                $busCompany  = $MIOLO->getBusiness('basic', 'BusCompany');
                $company     = $busCompany->getCompany(DEFAULT_COMPANY_CONF);

                $pdf->ln(6);
                $pdf->setX(20);
                $pdf->cell(leftRight, 0, $company->name . '.', 0, 0, 'L');
        
                $pdf->ln(8);
                $pdf->setX(35);
                $pdf->cell(leftRight, 0, '         Atenciosamente                                                                                     Pró-Reitoria e', 0, 0, 'L');
        
                $pdf->ln(6);
                $pdf->setX(35);
                $pdf->cell(leftRight, 0, '                                                                                                                  Secretaria de Ensino', 0, 0, 'L');
        
        
                $pdf->ln(6);
                $pdf->setX(20);
                $pdf->cell(leftRight, 0, 'Senhor (a)', 0, 0, 'L');
        
                $pdf->ln(6);
                $pdf->setX(20);
                $pdf->cell(leftRight, 0, ''.$row2[0], 0, 0, 'L');
        
                $pdf->ln(6);
                $pdf->setX(20);
                $pdf->cell(leftRight, 0, ''.$row2[2].' - '.$row2[3], 0, 0, 'L');
        
                $pdf->ln(6);
                $pdf->setX(20);
                $pdf->cell(leftRight, 0, ''.$row2[4], 0, 0, 'L');
        
                $pdf->ln(6);
                $pdf->setX(20);
                $pdf->cell(leftRight, 0, ''.$row2[12].' - '.$row2[1], 0, 0, 'L');
            }
        }
    }

        //Close and generate the document        
        $pdf->close();
        $pdf->output();
    }
}

?>
