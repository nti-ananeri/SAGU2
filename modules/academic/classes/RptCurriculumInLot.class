<?
/**
*
* @author Giovani Murilo Dantas Correa [gmurilo@isolution.inf.br]
*
* $version: $Id$
*
* \b Maintainers \n
* Daniel Afonso Heisler [daniel@isolution.inf.br]
*
* @since
* Class created on 25/03/2009
*
* \b Organization: \n
* iSolution - Soluções de Internet \n
* The iSolution TEAM
*
* \b CopyLeft: \n
* CopyLeft (L) 2007 iSolution - Soluções de Internet \n
*
* \b License \n
* Licensed under GPL (for further details read the COPYING file or http://www.gnu.org/copyleft/gpl.html )
*
* \b History \n
* See history in CVS repository: http://isolution.inf.br   
*
**/
set_time_limit(0);        
$MIOLO = MIOLO::getInstance();

$MIOLO->getClass('academic', 'RptCurriculum');

class RptCurriculumInLot extends RptCurriculum
{
    public $module = 'academic';
    public function __construct($filters = NULL)
    {
        $this->isInLot = true;
        $this->useUserInfo = false;
        $this->title = strtoupper(_M('Curriculum', 'academic'));
        $MIOLO = MIOLO::getInstance();
        $db = $MIOLO->getBusiness('academic', 'BusCourseOccurrence');
        $busCurriculum = $MIOLO->getBusiness($this->module, 'BusCurriculumPDF');
 
        $courses = $db->searchCourseOccurrence($filters);
        $x = 1;
        PDF::__construct($filters);    

        if ( strlen((string)$filters->contractId) > 0 )
        {
            $this->contract = $busCurriculum->getContract($this->filters);
        }

        foreach ( $courses as $course )
        {
            unset($filter);
            unset($this->totais);
            $filter->courseId      = $course[0];
            $filter->courseVersion = $course[2];
            $filter->turnId        = $course[3];
            $filter->unitId        = $course[5];
            $filter->contractId    = $filters->contractId;
            unset($this->curriculums, $this->contract);
            $this->curriculums = $busCurriculum->getCurriculum($filter);

            if ( strlen((string)$filters->contractId) > 0 )
            {
                $this->contract = $busCurriculum->getContract($this->filters);
            }

            if ( count($this->curriculums->curricularComponents) > 0 )
            {
                $this->addPage('L', 'mm', 'A4');
                $this->aliasNbPages();
                $this->PageBreakTrigger = ($this->h-$this->tMargin)-2;
                $this->generatePDF();
            }
            if( strlen((string)$filters->contractId) > 0 )
            {
                PDF::generatePDF();
                return;
            }
        }
        PDF::generatePDF();
    }
}
?>
