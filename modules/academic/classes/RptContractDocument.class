<?php
set_time_limit(0);
$MIOLO  = MIOLO::getInstance();
define('REPORT_ID', 'Contrato Para Prestação de Serviços');
$module = 'academic';
define('FPDF_FONTPATH', $MIOLO->getModulePath('basic', '/classes/fpdf/font/'));
$MIOLO->Uses('classes/fpdf/pdf.php', 'basic');

class RptContractDocument extends PDF
{
	public function __construct($filters = NULL)
	{
		$MIOLO = MIOLO::getInstance();
		$filters->unitId = $filters->academic->contract->unitId;
		$this->title = strtoupper(REPORT_ID)." - ". strtoupper(_M('Period', 'academic')).": ". (strlen((string)$filters->periodId) > 0 ? $filters->periodId : CURRENT_PERIOD_ID) ;
		//      $this->title = strtoupper(REPORT_ID);
		parent::__construct($filters);
		$this->useUserInfo = false;
		$this->AddPage('P', 'mm', 'A4');
		$this->aliasNbPages();
		$this->generatePDF($filters);
	}

	public function generatePDF($data)
	{
		$this->generateContent($data);
		PDF::generatePDF();
	}

	public function Header()
	{
		parent::Header();
	}

	public function Footer()
	{
		$this->lsize = 5;
		parent::Footer();
	}

	protected function replaceText($rdata)
	{
		parent::replaceText($rdata);
		if ( strlen((string)$rdata->contractText) > 0 )
		{
			$text = $rdata->contractText;
		}
		elseif ( $rdata->academic->contract->formationLevelId == GRADUATION_FORMATION_LEVEL_ID )
		{
			if ( $rdata->basic->responsable->cpf != $rdata->academic->contract->cpf && strlen((string)$rdata->basic->responsable->cpf) > 0 && defined('GRADUATION_DOCUMENT_TEXT_RESPONSABLE') )
			{
				$text = GRADUATION_DOCUMENT_TEXT_RESPONSABLE;
			}
			else
			{
				$text = GRADUATION_DOCUMENT_TEXT;
			}
		}
		elseif ( $rdata->academic->contract->formationLevelId == TECHNICAL_FORMATION_LEVEL_ID )
		{
			if ( $rdata->basic->responsable->cpf != $rdata->academic->contract->cpf && strlen((string)$rdata->basic->responsable->cpf) > 0 && defined('TECHNICAN_DOCUMENT_TEXT_RESPONSABLE') )
			{
				$text = TECHNICAN_DOCUMENT_TEXT_RESPONSABLE;
			}
			else
			{
				$text = TECHNICAN_DOCUMENT_TEXT;
			}
		}
		elseif ( $rdata->academic->contract->formationLevelId == MASTER_FORMATION_LEVEL_ID)
		{
			$text = MASTER_DOCUMENT_TEXT;
		}
		elseif ( $rdata->academic->contract->formationLevelId == AFTER_GRADUATION_FORMATION_LEVEL_ID )
		{
			$text = AFTER_GRADUATION_DOCUMENT_TEXT;
		}
		elseif ( $rdata->academic->contract->formationLevelId == EXTENSION_FORMATION_LEVEL_ID)
		{
			if ( $rdata->basic->responsable->cpf != $rdata->academic->contract->cpf && strlen((string)$rdata->basic->responsable->cpf) > 0 && defined('EXTENSION_DOCUMENT_TEXT_RESPONSABLE') )
			{
				$text = EXTENSION_DOCUMENT_TEXT_RESPONSABLE;
			}
			else
			{					
				$text = EXTENSION_DOCUMENT_TEXT;
			}
		}
		elseif ( $rdata->academic->contract->formationLevelId == SPECIALIZATION_FORMATION_LEVEL_ID)
		{
			if ( $rdata->basic->responsable->cpf != $rdata->academic->contract->cpf && strlen((string)$rdata->basic->responsable->cpf) > 0 && defined('SPECIALIZATION_DOCUMENT_TEXT_RESPONSABLE') )
			{
				$text = SPECIALIZATION_DOCUMENT_TEXT_RESPONSABLE;
			}
			else
			{
				$text = SPECIALIZATION_DOCUMENT_TEXT;
			}
		}
		$text = str_replace($this->procurar, $this->substituir, $text);
		if ( defined('APPEND_DOCUMENT_TEXT_PRINT') && defined('APPEND_DOCUMENT_TEXT'))
		{
			$this->textAppend = str_replace($this->procurar, $this->substituir, APPEND_DOCUMENT_TEXT);
		}
		return $text;
	}

	protected function generateContent($rdata)
	{
		$MIOLO  = MIOLO::getInstance();
		$module = MIOLO::getCurrentModule();
		$module = 'academic';
		$this->setFont(DEFAULT_REPORT_FONT, '', 8);

		$this->lsize = 4;
		$text = $this->replaceText($rdata);
			
		$this->multiCell($this->psize, $this->lsize, $text, null, 'J');
		$this->ln();
		$this->ln($this->lsize*2);
		$this->MultiCell($this->psize, $this->lsize,$this->pdfInfo->legalPerson->cityName.', '.date('d').' de '.SAGU::listMonths(date('n')).' de '.date('Y'),'','C');
		$this->ln($this->lsize*2);
		$this->Cell(($this->psize/10)*1, $this->lsize,'','','C');
		$this->Cell(($this->psize/10)*8, $this->lsize,'','B','C');
		$this->ln($this->lsize+1);
		$this->MultiCell($this->psize, $this->lsize,$this->pdfInfo->legalPerson->name . ' - ' . $this->pdfInfo->legalPerson->shortName ,'','C');
		$this->ln($this->lsize*2);
		$this->Cell(($this->psize/10)*1, $this->lsize,'','','C');
		$this->Cell(($this->psize/10)*8, $this->lsize,'','B','C');
		$this->ln($this->lsize+1);
		$txt = 'CONTRATANTE';
		if ( $rdata->academic->contract->cpf != $rdata->basic->responsable->cpf && strlen((string)$rdata->basic->responsable->cpf) > 0  )
		{
			$txt = '1º CONTRATANTE';
		}
		$this->MultiCell($this->psize, $this->lsize, $txt,'','C');
		$this->ln($this->lsize*2);


		if ( $rdata->academic->contract->cpf != $rdata->basic->responsable->cpf && strlen((string)$rdata->basic->responsable->cpf) > 0  )
		{

			$this->Cell(($this->psize/10)*2, $this->lsize,'','','C');
			$this->Cell(($this->psize/10)*6, $this->lsize,'','B','C');
			$this->ln($this->lsize+1);
			$this->MultiCell($this->psize, $this->lsize,'2º CONTRATANTE' ,'','C');
			$this->ln($this->lsize*2);
		}

		$this->Cell(($this->psize/14)*0.5, $this->lsize, '');
		$this->Cell(($this->psize/14)*6.0, $this->lsize,'', 'B');
		$this->Cell(($this->psize/14)*0.5, $this->lsize, '');
		$this->Cell(($this->psize/14)*0.5, $this->lsize, '');
		$this->Cell(($this->psize/14)*6.0, $this->lsize,'', 'B');
		$this->ln();
		$this->Cell(($this->psize/14)*0.5, $this->lsize, '');
		$this->Cell(($this->psize/14)*6.0, $this->lsize,'1ª Testemunha', '');
		$this->Cell(($this->psize/14)*0.5, $this->lsize, '');
		$this->Cell(($this->psize/14)*0.5, $this->lsize, '');
		$this->Cell(($this->psize/14)*6.0, $this->lsize,'2ª Testemunha', '');
		$this->ln();
		$this->Cell(($this->psize/14)*0.5, $this->lsize, '');
		$this->Cell(($this->psize/14)*6.0, $this->lsize,'CPF:', '');
		$this->Cell(($this->psize/14)*0.5, $this->lsize, '');
		$this->Cell(($this->psize/14)*0.5, $this->lsize, '');
		$this->Cell(($this->psize/14)*6.0, $this->lsize,'CPF:', '');
		if ( strlen((string)$this->textAppend) )
		{
			$this->addPage();
			$this->multiCell($this->psize, $this->lsize, $this->textAppend, '', 'J');
		}
	}
}
?>
