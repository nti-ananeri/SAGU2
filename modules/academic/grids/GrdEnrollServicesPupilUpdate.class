<?php

class GrdEnrollServicesPupilUpdate extends MGrid
{
    

    /**
     * Class constructor
     **/
    function __construct($filters)
    {
        $MIOLO  = MIOLO::getInstance();
        $module = MIOLO::getCurrentModule();
        $action = MIOLO::getCurrentAction();


        $valueField = new MTextField('valueField[]',  null, '', '15');
        $selRights  = new MTextLabel('selRights', '', '' );

        $columns = array( new MGridColumn( _M('Contract', 'academic') , 'right',  true, null, true, null, false ),
                          new MGridColumn( _M('Id',   $module ), 'right',  true, null, true, null, false ),
						  new MGridColumn( _M('Name',   $module ), 'left',  true, null, true, null, false ),
                          new MGridColumn( _M('Phone',$module ), 'left',  true, null, true, null, false ),
                          new MGridColumn( 'CPF' , 'right',  true, null, true, null, false ),
                          new MGridColumn( 'RG' , 'right',  true, null, true, null, false ),
                          new MGridColumn( _M('Birth',    $module), 'right',  true, null, true, null, false ),
                          new MGridColumn( _M('Email',    $module), 'left',  true, null, true, null, false ),
                          new MGridColumn( null ),
                          new MGridColumn( null ),
                          new MGridColumn( null ),
                          new MGridColumn( _M('Last modification',    'basic'), 'right',  true, null, true, null, false ),

                        );
       // this foreach is necessary until the getActionURL function is
       // able to handle an object parameter
       unset($opts);
       
       if (is_array($filters))
       {
			foreach ( $filters as $k => $v )
			{
				$opts[$k] = $v;
			}
		}

		$url = $MIOLO->getActionURL($module, $action, null, $opts);

        $opts = array('function'=>'print',
                    'contractId'=>'%1%',
                    'event'=>'btnPrintContract_click' );
        $href_print = $MIOLO->getActionURL( $module, '', null, $opts );
		parent::__construct(null, $columns, $url, 0, 0, 'GrdEnrollServicesPupilUpdate');

        $opts = array('personId'=>'%1%', 'function'=>'update');

        $hrefEditContract = $MIOLO->getActionURL($module, $home,  null, $opts);
        $this->addActionIcon(_M('Edit', 'miolo'), 'edit', $hrefEditContract);
        $this->addActionIcon(_M('View contract','services'), array('print.png'), $href_print);
        $opts = array('function'=>'print',
                    'contractId'=>'%0%',
                    'invoiceId'=>'%8%',
                    'event'=>'btnPrintInvoice_click' );
        $href_print = $MIOLO->getActionURL( $module, '', null, $opts );
        $this->addActionIcon(_M('Print invoice','finance'), array('print.png', 'print_disable.png'), $href_print);
		$this->addActionSelect();

        $opts = array('function'=>'print',
                    'contractId'=>'%0%',
                    'event'=>'btnPrintInvoices_click' );
        $href_print = $MIOLO->getActionURL( $module, '', null, $opts );
        $this->addActionIcon(_M('Print invoices in lot','finance'), array('print.png', 'print_disable.png'), $href_print);
		$this->addActionSelect();
        $this->setRowMethod('GrdEnrollServicesPupilUpdate', 'myRowMethod');
    }

    /*
     * Event to execute for each row of grid
     */
    public function myRowMethod($i, $row, $actions, $columns )
    {
        $MIOLO = MIOLO::getInstance();
        //botÃ£o de impressao habilitado ou desabilitado
        if ( $row[9] == SAGU::formatNumber('0') || strlen((string)$row[8]) == 0  )
        {
            $actions[2]->enabled = false;
            $actions[3]->enabled = false;
        }
        else
        {
            $actions[2]->enabled = true;
            if ( $row[15] > 0 )
            {
                $actions[3]->enabled = true;
            }
            else
            {
                $actions[3]->enabled = false;
            }
        }

        if( strlen((string)$row[8]) != 0 )
        {
            $actions[2]->value = 'icon_' . $row[10] . '.png';
            $actions[2]->valueoff = 'icon_' . $row[10] . '_disable.png';    
        }
        else
        {
            $actions[2]->value = 'print.png';
            $actions[2]->valueoff = 'print_disable.png';    

        }
        if( strlen((string)$row[15]) > 0 && strlen((string)$row[8]) != 0  )
        {
            $actions[3]->value = 'icon_' . $row[10] . '.png';
            $actions[3]->valueoff = 'icon_' . $row[10] . '_disable.png';    
        }
        else
        {
            $actions[3]->value = 'print.png';
            $actions[3]->valueoff = 'print_disable.png';    

        }
    }
 }

?>
