<?php

class FrmEnrollInit extends MForm
{
    private $home;
    private $enrollData;

    /**
     * Class constructor
     **/
    function __construct($data)
    {
        $this->home = $data->home;

        parent::__construct(_M('Enroll', 'academic'));
        $this->setHelp(get_class($this), MIOLO::getCurrentModule(), MIOLO::getCurrentAction());

        $this->eventHandler();
    }

    /**
     * Default method to define fields
     **/
    public function createFields()
    {
        $MIOLO   	 = MIOLO::getInstance();
        $module   	= MIOLO::getCurrentModule();
        $action   	= MIOLO::getCurrentAction();
        $function 	= MIOLO::_request('function');
	
		$separator = new MSeparator();

		//Divs de texto
		$msgTxt1     = new MText('msgTxt1', $this->messageReplace(PUPIL_ENROLL_MESSAGE));
        $cntTxt1     = new MHContainer('cntTxt1', array($msgTxt1, $div1, $separator));

        $fields[] = $cntTxt1;
        
		if(!$this->enrollData)
        {
            $this->enrollData = unserialize(urldecode(stripslashes($MIOLO->session->getValue('enrollData'))));
 
        }
        $flds[] = new MButton('tbBtnNext',_M('Next','basic'),'');
        $fields[] = new MDiv('divBtns',$flds,null,'align=center');
        $fields[] = new Separator('');
        $MIOLO->session->setValue('enrollData', urlencode(serialize($this->enrollData)));

        $this->setFields($fields);
        $this->setLabelWidth(FIELD_LABEL_SIZE);
        $this->setShowPostButton(false);
        $this->setClose($MIOLO->getActionURL($module,substr($action,0,strrpos($action,':'))));

    }

    public function tbBtnNext_click($sender = null)
    {
        $MIOLO    = MIOLO::getInstance();
        $module   = MIOLO::getCurrentModule();
        $action   = MIOLO::getCurrentAction();
        $MIOLO->session->setValue('enrollData', urlencode(serialize($this->enrollData)));

        $opts = array('page' => '1');  

        $this->page->mGoto($MIOLO->getActionURL($module, $action, null, $opts));
    }
    
    public function messageReplace($message = PUPIL_ENROLL_MESSAGE)
    {
        $MIOLO   	 = MIOLO::getInstance();
        //pega os dados da instituicao
        $businessCompany = $MIOLO->getBusiness('basic', 'BusCompany');
        $company         = $businessCompany->getCompany(DEFAULT_COMPANY_CONF);
        $businessLP = $MIOLO->getBusiness('basic', 'BusLegalPerson');
        $legalPerson        = $businessLP->getLegalPerson($company->personId);
        foreach($legalPerson as $item => $value )
        {
            $message = str_replace('legalPerson->'.$item, $value, $message);
        }
        $message = str_replace('CURRENT_PERIOD_ID', CURRENT_PERIOD_ID, $message);
        return $message;
    }
}

?>
