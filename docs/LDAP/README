TUTORIAL DE INTEGRAÇÃO DO SAGU2 COM LDAP
----------------------------------------

Este tutorial demonstra como fazer o Sagu2 utilizar como base de usuários uma base LDAP.

Não é objetivo deste tutorial explicar como se instala nem como funciona LDAP. 
Por isso, para conseguir executar com sucesso os passos descritos abaixo, é necessário já ter uma base LDAP previamente instalada e rodando. 

Dentro da pasta onde se encontra esse tutorial (SAGU_PATH/docs/LDAP), existe um diretório chamado "files" que contém 4 arquivos.

	- miolo.schema , sagu2.schema : São dois schemas LDAP essencias para o funcionamento do Sagu2 com LDAP. Esses arquivos devem ser colocados no diretório de schemas de sua base LDAP, geralmente localizado em "/etc/ldap/schema".
	- slapd.conf : Arquivo de exemplo de configuração do LDAP, geralmente localizado em "/etc/ldap/slapd.conf".
	- sagu2.ldif : Dump de uma estrutura mínima de uma base LDAP, para o funcionamento do Sagu2 com LDAP, com dois usuários criados.

Depois de acertada a configuração da base LDAP com os esquemas do miolo e do sagu2, é necessário adicionar o arquivo ldif com a estrutura do sagu2 na base LDAP.

Depois de executados esses procedimentos, sua base LDAP estará pronta para suportar o Sagu2.

----------------------------------------

Agora vem a parte da configuração do Sagu2, referenciando a base LDAP recentemente criada.

Dois arquivos precisam ser alterados:

	- SAGU_ROOT/etc/miolo.conf:
		Na seção "<mad>" é necessário alterar a tag "<module>" para "admin_ldap".
		Na seção "<login>" é necessário alterar a tag "<module>" para "admin_ldap", a tag "<class>" para "MAuthLdap" e a tag "<perms>" para "MPermsLdap". Nesta seção também é necessário adicionar (pode ser após a tag "<auto>") uma nova seção chamada "<ldap>", conforme exemplo abaixo:

		<ldap>
		    <host>127.0.0.1</host>
		    <port>389</port>
		    <base>dc=solis,dc=coop,dc=br</base>
		    <user>cn=Admin,dc=solis,dc=coop,dc=br</user>
		    <password>admin</password>
		    <schema>custom</schema>
		    <custom>(AND(objectClass=sagu2)(|(codAluno=%login%)(uid=%login%)))</custom>
		    <userName>cn</userName>
		    <login>uid</login>
		    <idperson>codaluno</idperson>
		</ldap>

	- SAGU_ROOT/modules/admin_ldap/etc/module.conf:
		Alterar a seção "<login>" conforme exemplo abaixo:

		<ldap>
		    <host>12.0.0.1</host>
		    <port>389</port>
		    <base>dc=solis,dc=coop,dc=br</base>
		    <user>cn=Admin,dc=solis,dc=coop,dc=br</user>
		    <password>admin</password>
		    <userName>cn</userName>
		    <userEmail>mail</userEmail>
		    <schema>system</schema>
		</ldap>


Pronto! Agora seu Sagu2 já está usando LDAP para gerenciamento de seus usuários.

Ps.: O Miolo2/Sagu2 não gerenciam a criação e a exclusão de usuários da base LDAP, apenas gerenciam as permissões. Para criar, definir senhas, excluir, entre outros, é necessário utilizar outro software.
